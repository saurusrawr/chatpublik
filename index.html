<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Horor - Saurus</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Creepster&display=swap" rel="stylesheet">

<style>
:root{
  --red:#8b0000;
  --dark:#120000;
  --gold:#ffd700;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Poppins,sans-serif;
  background:linear-gradient(to bottom,#200,#000);
  color:#fff;
  height:100vh;
  overflow:hidden;
}
.hidden{display:none}

.screen{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
}

/* LOGIN */
.login-box{
  margin:auto;
  background:rgba(0,0,0,.6);
  padding:40px;
  border-radius:20px;
  border:2px solid var(--red);
  text-align:center;
}
.login-box h1{
  font-family:Creepster;
  font-size:3rem;
}
input{
  width:100%;
  padding:15px;
  margin-top:15px;
  border-radius:12px;
  border:none;
}
button{
  margin-top:15px;
  padding:15px;
  width:100%;
  border:none;
  border-radius:12px;
  background:var(--red);
  color:#fff;
  font-size:1.1rem;
  cursor:pointer;
}

/* DASHBOARD */
.header{
  padding:15px;
  background:rgba(139,0,0,.8);
  display:flex;
  justify-content:space-between;
}
#daftar-room{
  padding:20px;
  overflow-y:auto;
  flex:1;
}
.room{
  background:rgba(255,255,255,.1);
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
  cursor:pointer;
}

/* CHAT */
#pesan{
  flex:1;
  padding:15px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.msg{
  max-width:75%;
  padding:12px;
  border-radius:15px;
}
.kirim{background:var(--red);align-self:flex-end}
.terima{background:rgba(255,255,255,.15)}
.owner{
  background:linear-gradient(45deg,#ffd700,#ffae00);
  color:#000;
  padding:3px 8px;
  border-radius:10px;
  margin-left:5px;
  font-size:.8rem;
}
.input-area{
  display:flex;
  gap:10px;
  padding:10px;
  background:#1a0000;
}
.input-area input{
  flex:1;
}

/* TELEPON */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:flex;
  justify-content:center;
  align-items:center;
}
.modal .box{
  background:#200;
  padding:30px;
  border-radius:20px;
  text-align:center;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen">
  <div class="login-box">
    <h1>Chat Horor</h1>
    <p>By Saurus</p>
    <input id="nama" placeholder="Nama kamu">
    <button onclick="login()">Masuk</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="screen hidden">
  <div class="header">
    <b>Daftar Room</b>
    <button onclick="logout()">Keluar</button>
  </div>
  <div id="daftar-room"></div>
  <button onclick="buatRoom()">+ Buat Room</button>
</div>

<!-- CHAT -->
<div id="chat" class="screen hidden">
  <div class="header">
    <button onclick="back()">‚Üê</button>
    <span id="roomName"></span>
    <button onclick="openCall()">üìû</button>
  </div>

  <div id="pesan"></div>

  <div class="input-area">
    <input id="text">
    <button onclick="kirim()">‚û§</button>
  </div>
</div>

<!-- TELEPON -->
<div id="call" class="modal hidden">
  <div class="box">
    <h2>Telepon Horor</h2>
    <p>Suara dari kegelapan...</p>
    <button onclick="closeCall()">Akhiri</button>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyBer_DF3-zAyH2rmnMpzilUiE5BYTb4In0",
  authDomain:"saurusproject-6974b.firebaseapp.com",
  databaseURL:"https://saurusproject-6974b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"saurusproject-6974b",
  storageBucket:"saurusproject-6974b.appspot.com"
});
const auth=firebase.auth();
const db=firebase.database();

/* STATE */
let user="", roomId="", isOwner=false;

/* LOGIN */
function login(){
  user=document.getElementById("nama").value.trim();
  if(!user) return alert("Isi nama");
  isOwner=user.toLowerCase().includes("saurus");
  auth.signInAnonymously().then(()=>{
    loginHide();
    loadRooms();
  });
}
function loginHide(){
  login.classList.add("hidden");
  dashboard.classList.remove("hidden");
}
function logout(){
  auth.signOut().then(()=>location.reload());
}

/* ROOM */
function loadRooms(){
  db.ref("rooms").on("value",snap=>{
    daftar-room.innerHTML="";
    snap.forEach(r=>{
      let d=document.createElement("div");
      d.className="room";
      d.textContent=r.val().nama;
      d.onclick=()=>join(r.key,r.val().nama);
      daftar-room.appendChild(d);
    });
  });
}
function buatRoom(){
  let nama=prompt("Nama room?");
  if(!nama)return;
  db.ref("rooms").push({nama});
}
function join(id,nama){
  roomId=id;
  dashboard.classList.add("hidden");
  chat.classList.remove("hidden");
  roomName.textContent=nama;
  pesan.innerHTML="";
  db.ref("rooms/"+id+"/msg").on("child_added",s=>{
    render(s.val());
  });
}

/* CHAT */
function kirim(){
  let t=text.value.trim();
  if(!t)return;
  db.ref("rooms/"+roomId+"/msg").push({
    u:user,
    t:t,
    o:isOwner
  });
  text.value="";
}
function render(m){
  let d=document.createElement("div");
  d.className="msg "+(m.u===user?"kirim":"terima");
  d.innerHTML=`<b>${m.u}${m.o?'<span class="owner">OWNER</span>':''}</b><br>${m.t}`;
  pesan.appendChild(d);
  pesan.scrollTop=pesan.scrollHeight;
}
function back(){
  chat.classList.add("hidden");
  dashboard.classList.remove("hidden");
}

/* TELEPON */
function openCall(){
  document.getElementById("call").classList.remove("hidden");
}
function closeCall(){
  document.getElementById("call").classList.add("hidden");
}
</script>

</body>
</html>
