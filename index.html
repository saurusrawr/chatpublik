<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Saurus Store</title>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <style>
    body { 
      margin: 0; font-family: system-ui, sans-serif; 
      background: #0d1117; color: #c9d1d9; min-height: 100vh; 
      overflow-y: auto; 
    }
    .container { padding: 15px; max-width: 100%; margin: 0 auto; }
    h1 { text-align: center; margin: 20px 0; font-size: 2.2rem; color: #58a6ff; }
    .input-box { margin: 20px 0; text-align: center; }
    input { width: 90%; padding: 15px; font-size: 1.1rem; border-radius: 10px; border: 1px solid #30363d; background: #161b22; color: #eee; }
    button { width: 90%; padding: 15px; margin: 10px 0; background: #21262d; color: #58a6ff; border: 1px solid #30363d; border-radius: 10px; font-size: 1.1rem; cursor: pointer; }
    .product-list { display: flex; flex-direction: column; gap: 15px; }
    .product { background: #161b22; padding: 15px; border-radius: 15px; border: 1px solid #30363d; box-shadow: 0 2px 10px rgba(0,0,0,0.5); }
    .product h3 { margin: 0 0 10px; font-size: 1.3rem; color: #58a6ff; }
    .product p { margin: 5px 0; color: #8b949e; }
    .buy-btn { background: #238636; color: white; padding: 12px; border: none; border-radius: 10px; width: 100%; font-size: 1.1rem; cursor: pointer; margin-top: 10px; }
    .cart-icon { position: fixed; top: 15px; right: 15px; background: #21262d; color: #58a6ff; padding: 10px 15px; border-radius: 50%; font-size: 1.2rem; border: 2px solid #30363d; cursor: pointer; z-index: 100; display: flex; align-items: center; gap: 5px; }
    .cart-count { background: #58a6ff; color: #000; border-radius: 50%; padding: 5px 10px; font-size: 0.9rem; }
    .cart-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: flex; flex-direction: column; padding: 20px; z-index: 99; overflow-y: auto; }
    .cart-modal.hidden { display: none; }
    .cart-item { background: #161b22; padding: 15px; margin: 10px 0; border-radius: 10px; border: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
    .order-btn { width: 100%; padding: 15px; margin-top: 20px; background: #238636; color: white; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; }
    .admin-section { background: #161b22; padding: 20px; border-radius: 15px; margin: 20px 0; border: 1px solid #58a6ff; }
    .admin-input { margin: 10px 0; }
    .admin-btn { background: #21262d; color: #58a6ff; border: 1px solid #58a6ff; }
  </style>
</head>
<body>

<div class="container">

  <!-- Login -->
  <div id="login">
    <h1>Saurus Store</h1>
    <div class="input-box">
      <input type="text" id="nama" placeholder="Masukkan nama kamu...">
      <button onclick="masuk()">Masuk</button>
    </div>
  </div>

  <!-- Dashboard & Keranjang -->
  <div id="dashboard" class="hidden">
    <h1>Selamat Datang, <span id="user-name"></span>!</h1>
    <h2>Daftar Produk</h2>
    <div id="product-list" class="product-list"></div>

    <!-- Admin Panel (hanya kalau nama persis {khusus:owner}) -->
    <div id="admin-panel" class="admin-section hidden">
      <h3>Admin Panel</h3>
      <div class="admin-input">
        <input type="text" id="new-nama" placeholder="Nama Produk">
        <input type="number" id="new-harga" placeholder="Harga (contoh: 5000)">
        <button class="admin-btn" onclick="tambahProduk()">Tambah Produk</button>
      </div>
    </div>

    <!-- Ikon Keranjang -->
    <div class="cart-icon" onclick="tampilKeranjang()">
      ðŸ›’ <span id="cart-count" class="cart-count">0</span>
    </div>

    <!-- Modal Keranjang -->
    <div id="cart-modal" class="cart-modal hidden">
      <h2>Keranjang Belanja</h2>
      <div id="cart-items"></div>
      <button class="order-btn" onclick="orderWA()">Order via WhatsApp</button>
      <button class="order-btn" onclick="orderTelegram()">Order via Telegram</button>
      <button style="margin-top:10px;background:#e74c3c;" onclick="tutupKeranjang()">Tutup</button>
    </div>
  </div>

</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBer_DF3-zAyH2rmnMpzilUiE5BYTb4In0",
    authDomain: "saurusproject-6974b.firebaseapp.com",
    databaseURL: "https://saurusproject-6974b-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "saurusproject-6974b",
    storageBucket: "saurusproject-6974b.appspot.com",
    messagingSenderId: "519472343742",
    appId: "1:519472343742:web:xxxxxxxxxxxxxxxx" // Ganti kalau punya
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let namaUser = '';
  let isOwner = false;
  let keranjang = []; // array lokal untuk keranjang

  // Login
  function masuk() {
    namaUser = document.getElementById('nama').value.trim();
    if (!namaUser) return alert('Nama wajib diisi!');

    // Owner mode hanya kalau nama PERSIS {khusus:owner}
    isOwner = namaUser === '{khusus:owner}';
    if (isOwner) namaUser = 'Owner';

    document.getElementById('login').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    document.getElementById('user-name').textContent = namaUser;

    tampilProduk();

    // Tampil admin panel hanya kalau owner
    if (isOwner) document.getElementById('admin-panel').classList.remove('hidden');
  }

  // Tampil daftar produk dari Firebase
  function tampilProduk() {
    db.ref('products').on('value', snapshot => {
      const list = document.getElementById('product-list');
      list.innerHTML = '';
      const products = snapshot.val() || {};

      Object.keys(products).forEach(key => {
        const p = products[key];
        const div = document.createElement('div');
        div.className = 'product';
        div.innerHTML = `
          <h3>${p.nama}</h3>
          <p>Harga: Rp ${p.harga.toLocaleString('id-ID')}</p>
          <button class="buy-btn" onclick="tambahKeKeranjang('${p.nama}', ${p.harga})">Tambah ke Keranjang</button>
        `;

        if (isOwner) {
          const editBtn = document.createElement('button');
          editBtn.innerText = 'Edit';
          editBtn.style.background = '#3498db';
          editBtn.style.margin = '5px 0';
          editBtn.onclick = () => editProduk(key, p.nama, p.harga);
          div.appendChild(editBtn);

          const delBtn = document.createElement('button');
          delBtn.innerText = 'Hapus';
          delBtn.style.background = '#e74c3c';
          delBtn.onclick = () => hapusProduk(key);
          div.appendChild(delBtn);
        }

        list.appendChild(div);
      });
    });
  }

  // Tambah ke keranjang lokal
  function tambahKeKeranjang(nama, harga) {
    keranjang.push({ nama, harga });
    updateCartCount();
  }

  // Update jumlah di ikon keranjang
  function updateCartCount() {
    document.getElementById('cart-count').textContent = keranjang.length;
  }

  // Tampil modal keranjang
  function tampilKeranjang() {
    const modal = document.getElementById('cart-modal');
    const itemsDiv = document.getElementById('cart-items');
    itemsDiv.innerHTML = '';
    keranjang.forEach(item => {
      const div = document.createElement('div');
      div.innerHTML = `<p>${item.nama} - Rp ${item.harga.toLocaleString('id-ID')}</p>`;
      itemsDiv.appendChild(div);
    });
    modal.classList.remove('hidden');
  }

  function tutupKeranjang() {
    document.getElementById('cart-modal').classList.add('hidden');
  }

  // Order WA
  function orderWA() {
    if (keranjang.length === 0) return alert('Keranjang kosong!');
    let pesan = `Hai saurus Aku ${namaUser} Ingin membeli\n`;
    keranjang.forEach(item => {
      pesan += `${item.nama} dengan harga ${item.harga}\n`;
    });
    pesan = encodeURIComponent(pesan);
    window.open(`https://wa.me/62895393336779?text=${pesan}`, '_blank');
    keranjang = []; // kosongkan keranjang setelah order
    updateCartCount();
    tutupKeranjang();
  }

  // Order Telegram
  function orderTelegram() {
    if (keranjang.length === 0) return alert('Keranjang kosong!');
    let pesan = `Hai saurus Aku ${namaUser} Ingin membeli\n`;
    keranjang.forEach(item => {
      pesan += `${item.nama} dengan harga ${item.harga}\n`;
    });
    pesan = encodeURIComponent(pesan);
    window.open(`https://t.me/lordsaurus?text=${pesan}`, '_blank');
    keranjang = [];
    updateCartCount();
    tutupKeranjang();
  }

  // Tambah produk baru (owner)
  function tambahProduk() {
    const nama = document.getElementById('new-nama').value.trim();
    const harga = parseInt(document.getElementById('new-harga').value);
    if (!nama || isNaN(harga)) return alert('Isi nama dan harga dengan benar!');

    const id = db.ref('products').push().key;
    db.ref('products/' + id).set({ nama, harga });
    document.getElementById('new-nama').value = '';
    document.getElementById('new-harga').value = '';
  }

  // Edit produk (owner)
  function editProduk(key, oldNama, oldHarga) {
    const nama = prompt('Nama baru:', oldNama);
    const harga = parseInt(prompt('Harga baru:', oldHarga));
    if (nama && !isNaN(harga)) {
      db.ref('products/' + key).update({ nama, harga });
    }
  }

  // Hapus produk (owner)
  function hapusProduk(key) {
    if (confirm('Yakin hapus produk ini?')) db.ref('products/' + key).remove();
  }
</script>
</body>
</html>
