<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horror Chat - Saurus</title>

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-storage-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Inter,sans-serif;
  background:url('https://raw.githubusercontent.com/saurusrawr/akirabot/main/uploads/2026-01-02/saurus_1767333392193_ddnui.jpg') center/cover fixed;
  color:#fff;
}
.overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
}
.screen{
  position:absolute;inset:0;
  display:flex;flex-direction:column;
}
.hidden{display:none}
.box{
  margin:auto;
  background:#111;
  padding:30px;
  border-radius:14px;
  width:90%;max-width:420px;
  text-align:center;
}
input,button{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  font-size:15px;
}
input{background:#222;color:#fff}
button{background:#000;color:#fff;border:1px solid #333}
button:hover{background:#222}

.header{
  background:#000;
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

#rooms,.chat-box{
  flex:1;overflow-y:auto;padding:15px
}
.room{
  background:#111;padding:15px;
  border-radius:12px;margin-bottom:10px;
}

.msg{
  max-width:80%;
  padding:10px 14px;
  border-radius:14px;
}
.me{background:#000;margin-left:auto}
.other{background:#222}
.msg img{max-width:100%;border-radius:10px;margin-top:6px}

.input-bar{
  display:flex;gap:8px;
  padding:10px;background:#000;
}
.input-bar input{flex:1}

.call-ui{
  position:fixed;inset:0;
  background:rgba(0,0,0,.85);
  display:flex;justify-content:center;align-items:center;
  z-index:9;
}
</style>
</head>
<body>
<div class="overlay"></div>

<!-- LOGIN -->
<div id="login" class="screen">
  <div class="box">
    <h2>Horror Chat</h2>
    <p>By Saurus</p>
    <input id="nama" placeholder="Nama kamu">
    <button onclick="login()">Masuk</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dash" class="screen hidden">
  <div class="header">
    <b>Room</b>
    <button onclick="logout()">Keluar</button>
  </div>
  <div id="rooms"></div>
  <button onclick="buatRoom()">+ Buat Room</button>
</div>

<!-- CHAT -->
<div id="chat" class="screen hidden">
  <div class="header">
    <button onclick="back()">‚Üê</button>
    <b id="roomName"></b>
    <button onclick="call()">üìû</button>
  </div>
  <div class="chat-box" id="msgs"></div>
  <div class="input-bar">
    <input id="text" placeholder="Ketik pesan...">
    <input type="file" id="img" hidden>
    <button onclick="pickImg()">üì∑</button>
    <button onclick="record()">üé§</button>
    <button onclick="send()">‚û§</button>
  </div>
</div>

<!-- CALL -->
<div id="callUI" class="call-ui hidden">
  <div class="box">
    <h3>Telepon Horor</h3>
    <p>Semua orang terhubung...</p>
    <button onclick="endCall()">Akhiri</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyBer_DF3-zAyH2rmnMpzilUiE5BYTb4In0",
  authDomain: "saurusproject-6974b.firebaseapp.com",
  databaseURL: "https://saurusproject-6974b-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "saurusproject-6974b",
  storageBucket: "saurusproject-6974b.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const st=firebase.storage();
const auth=firebase.auth();

let user="",room="",rec,chunk=[];

function login(){
  user=nama.value.trim();
  if(!user)return;
  auth.signInAnonymously().then(()=>{
    login.classList.add("hidden");
    dash.classList.remove("hidden");
    loadRooms();
  });
}

function loadRooms(){
  db.ref("rooms").on("value",s=>{
    rooms.innerHTML="";
    Object.entries(s.val()||{}).forEach(([id,r])=>{
      let d=document.createElement("div");
      d.className="room";
      d.textContent=r.name;
      d.onclick=()=>join(id,r.name);
      rooms.appendChild(d);
    });
  });
}

function buatRoom(){
  let n=prompt("Nama room?");
  if(n)db.ref("rooms").push({name:n});
}

function join(id,n){
  room=id;
  roomName.textContent=n;
  dash.classList.add("hidden");
  chat.classList.remove("hidden");

  db.ref(`rooms/${room}/call`).on("value",s=>{
    callUI.classList.toggle("hidden",!s.val());
  });

  db.ref(`rooms/${room}/msg`).on("child_added",s=>{
    let m=s.val();
    let d=document.createElement("div");
    d.className="msg "+(m.u==user?"me":"other");
    d.innerHTML=`<b>${m.u}</b><br>${m.t||""}${m.i?`<img src="${m.i}">`:""}`;
    d.onmousedown=()=>{if(m.u==user&&confirm("Hapus pesan ini?"))db.ref(`rooms/${room}/msg/${s.key}`).remove();}
    msgs.appendChild(d);
    msgs.scrollTop=msgs.scrollHeight;
  });
}

function send(){
  if(text.value){
    db.ref(`rooms/${room}/msg`).push({u:user,t:text.value});
    text.value="";
  }
}

function pickImg(){img.click()}
img.onchange=e=>{
  let f=e.target.files[0];
  text.value=f.name;
  send=()=>{
    let r=st.ref("img/"+Date.now()+f.name);
    r.put(f).then(()=>r.getDownloadURL()).then(u=>{
      db.ref(`rooms/${room}/msg`).push({u:user,i:u});
      text.value="";
    });
  }
}

function record(){
  navigator.mediaDevices.getUserMedia({audio:true}).then(s=>{
    rec=new MediaRecorder(s);
    rec.ondataavailable=e=>chunk.push(e.data);
    rec.onstop=()=>{
      let b=new Blob(chunk,{type:"audio/webm"});
      let r=st.ref("vn/"+Date.now());
      r.put(b).then(()=>r.getDownloadURL()).then(u=>{
        db.ref(`rooms/${room}/msg`).push({u:user,i:u});
      });
    };
    if(confirm("Rekam suara?"))rec.start();
    if(confirm("Stop?"))rec.stop();
    else{chunk=[];rec.stop();}
  });
}

function call(){db.ref(`rooms/${room}/call`).set(true)}
function endCall(){db.ref(`rooms/${room}/call`).remove()}
function back(){location.reload()}
function logout(){auth.signOut().then(()=>location.reload())}
</script>
</body>
</html>
